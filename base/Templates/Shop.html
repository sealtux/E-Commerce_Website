<html>
    <head>
        <meta charset ='UTF-8'>
        {% load static %}
        <link rel = 'stylesheet' href ="{%static 'shopstyle.css'%}" >
    </head>

    <body>

        <div class = 'layer1'>
             <!-- Header content here -->
              <div class = 'layer1sec'></div>
          
              <div class = categories>

              <button class = "store" > 
              <img src="{% static 'images/store.png' %}" class="storelogo"> Store
              </button>

              <form method="POST" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="action" value="movetofree">
                <button type="submit" class="free">
                  <img src="{% static 'images/gift.png' %}" class="giftlogo">
                  Free Items
                </button>
              </form>

              <form method = "POST" style = "display:inline;">
                 {% csrf_token %}
              <input type = 'hidden' name = "action" value="movetotrack">
              <button type = submit class = "track">
              <img src="{% static 'images/receipt.png' %}" class="receiptlogo"> Track Order</button>
              </form>  

              <form method = "POST" style = "display:inline;">
                 {% csrf_token %}
              <input type = 'hidden' name = "action" value="movetohelp">  <!--this for sending the value to the views (in the shop function)  -->
              <button type = submit class = "help">
              <img src="{% static 'images/question.png' %}" class="questionlogo">  Help</button>
              </form>
              

              <form method = "POST" style = "display:inline;">
                 {% csrf_token %}
              <input type = 'hidden' name = "action" value="movetogroup">  <!--this for sending the value to the views (in the shop function)  -->
              <button type = submit class = "group">
             <img src = "{%static 'images/groups.png' %}" class = "grouplogo">Groups</button>
              </form>
             

              
        </div>

        <button class = "cart"onclick="toggleFrame()">
        <img src = "{%static 'images/cart.png' %}" class = "cartlogo"></button>

       
        <div id="cartFrame" class="cart-frame">
          <div class = "containment">
            </div>
          <text id = "yourcart">Your Cart</text>
          
          <div class = "containment2">
            <div class = "circle1"><text id = "circle1msg">Fast Delivery</text></div>
            <div class = "circle2"><text id = "circle2msg">Good Support</text></div>
            <div class = "circle3"><text id = "circle3msg">Guaranteed</text></div>
          </div>
          <div class="cart-items"></div>
          <div class = "containment3">

          </div>
          <div class = "containment4">
            <button class = "checkout">Secure Checkout</button>
          </div>
          
        </div>
        
        
        </div>

        </div>

        <div class = 'layer2'>
             <!-- Main content here -->
        </div>

        <div class = 'notice'>
            <!--notice content here-->

            <p1 id = 'message'>hello</p1>

        </div>

        
            
            

    <div class = 'panel'>
                    <form method = "POST">
                        {% csrf_token %}
                        <img src="{% static 'images/search.png' %}" class="search-icon">

                        <img src="{% static 'images/filter.png' %}" class="filterlogo">

                        <input type = 'text' class = search name = searching></input>

                        <!-- for button layer-->
                        

                    </form>
                
                    <div class = "buttonlay">
                            
                            <button class = "All">All</button>
                            <button class = "Crops">Console</button>
                            <button class = "Pets">Mobile</button>
                            <button class = "Bundles">Computer</button>

                            </div>
                    

                <div class="combo">
        <h1 class="filter">Sort by:</h1>
        


    <div 
            class="custom-dropdown" 
            tabindex="0" 
            role="button" 
            onclick="toggleDropdown(this)" 
            onkeydown="if(event.key==='Enter' || event.key===' '){ this.click(); }"
        >
            <div class="selected">All</div>
            <div class="dropdown-options">
            <div data-value="">All</div>
            <div data-value="1st">A to Z</div>
            <div data-value="2nd">Price: Low - High</div>
            <div data-value="3rd">Price: High - Low</div>
            </div>
        </div>
        </div>

        <div class="order1" onmouseenter="popUp1(this)" onmouseleave="popDown1(this)">
        <img src="{% static 'products/computer1.webp' %}" alt="Product Image" class="productimage1">
        <h1 class = "order1title">Lenovo M20 Wired Mouse </h1>
        <button class="orderadd1" onclick="addToCart(this)" data-item-id="computer1" onmouseenter="addpopup(this)" onmouseleave="addpodown(this)">Add</button>
        <div class = "containmentprder">  <!--this is for the design(the line)  -->
        
      
        </div>
        <h1 class = "orderprice1">₱299</h1>
        <h1 class = "discount1">₱599</h1>
        <div class = discountline11></div>  <!--this is for the design(the discount line)  -->
        </div>

        <div class="order2" onmouseenter="popUp1(this)" onmouseleave="popDown1(this)">
        <img src="{% static 'products/computer2.webp' %}" alt="Product Image" class="productimage1">
        <h1 class = "order1title">A4Tech Op-720 Wired Mouse </h1>
        <button class="orderadd1" onclick="addToCart(this)" data-item-id="computer2"  onmouseenter="addpopup(this)" onmouseleave="addpodown(this)">Add</button>
        <div class = "containmentprder">  <!--this is for the design(the line)  -->
        </div>
        <h1 class = "orderprice1">₱99</h1>
        <h1 class = "discount1">₱200</h1>
        <div class = discountline11></div>  <!--this is for the design(the discount line)  -->
        </div>

        <div class="order3" onmouseenter="popUp1(this)" onmouseleave="popDown1(this)">
        
        <img src="{% static 'products/computer3.webp' %}" alt="Product Image" class="productimage1">
        <button class="orderadd1" onclick="addToCart(this)" data-item-id="computer3"  onmouseenter="addpopup(this)" onmouseleave="addpodown(this)">Add</button>
        <h1 class = "order1title">Gaming HeadPhone Noise Redcution</h1>
        <div class = "containmentprder">  <!--this is for the design(the line)  -->
        </div>
        <h1 class = "orderprice1">₱330</h1>
        <h1 class = "discount1">₱590</h1>
        <div class = discountline11></div>  <!--this is for the design(the discount line)  -->
        </div>

        <div class="order4" onmouseenter="popUp1(this)" onmouseleave="popDown1(this)">
        <img src="{% static 'products/console1.webp' %}" alt="Product Image" class="productimage1">
        <button class="orderadd1" onclick="addToCart(this)" data-item-id="console1"  onmouseenter="addpopup(this)" onmouseleave="addpodown(this)">Add</button>
        <h1 class = "order1title">PlayStation 5 Controller</h1>
        <div class = "containmentprder">  <!--this is for the design(the line)  -->
        </div>
        <h1 class = "orderprice1">₱389</h1>
        <h1 class = "discount1">₱899</h1>
        <div class = discountline11></div>  <!--this is for the design(the discount line)  -->
        </div>

        <div class="order5" onmouseenter="popUp1(this)" onmouseleave="popDown1(this)">
        <img src="{% static 'products/console2.webp' %}" alt="Product Image" class="productimage1">
        <button class="orderadd1" onclick="addToCart(this)" data-item-id="console2"  onmouseenter="addpopup(this)" onmouseleave="addpodown(this)">Add</button>
        <h1 class = "order1title">PlayStation 4 Controller Buy 1 Take 1</h1>
        <div class = "containmentprder">  <!--this is for the design(the line)  -->
        </div>
        <h1 class = "orderprice1">₱99</h1>
        <h1 class = "discount1">₱200</h1>
        <div class = discountline11></div>  <!--this is for the design(the discount line)  -->
        </div>

        <div class="order6" onmouseenter="popUp1(this)" onmouseleave="popDown1(this)">
        <img src="{% static 'products/mobile1.webp' %}" alt="Product Image" class="productimage1">
        <button class="orderadd1" onclick="addToCart(this)" data-item-id="mobile1"  onmouseenter="addpopup(this)" onmouseleave="addpodown(this)">Add</button>
        <h1 class = "order1title">Gaming Finger Sleeves</h1>
        <div class = "containmentprder">  <!--this is for the design(the line)  -->
        </div>
        <h1 class = "orderprice1">₱99</h1>
        <h1 class = "discount1">₱180</h1>
        <div class = discountline11></div>  <!--this is for the design(the discount line)  -->
        </div>

        <div class="order7" onmouseenter="popUp1(this)" onmouseleave="popDown1(this)">
        <img src="{% static 'products/mobile2.webp' %}" alt="Product Image" class="productimage1">
        <button class="orderadd1" onclick="addToCart(this)" data-item-id="mobile2"  onmouseenter="addpopup(this)" onmouseleave="addpodown(this)">Add</button>
        <h1 class = "order1title">Bluetooth Headset</h1>
        <div class = "containmentprder">  <!--this is for the design(the line)  -->
        </div>
        <h1 class = "orderprice1">₱47</h1>
        <h1 class = "discount1">₱150</h1>
        <div class = discountline11></div>  <!--this is for the design(the discount line)  -->
        </div>

       <div class="order8" onmouseenter="popUp1(this)" onmouseleave="popDown1(this)">
        <img src="{% static 'products/computer4.webp' %}" alt="Product Image" class="productimage1">
        <button class="orderadd1" onclick="addToCart(this)" data-item-id="computer4" onmouseenter="addpopup(this)" onmouseleave="addpodown(this)">Add</button>
        <h1 class = "order1title">Gaming Mechanical RGB Keyboard</h1>
        <div class = "containmentprder">  <!--this is for the design(the line)  -->
        </div>
        <h1 class = "orderprice1">₱399</h1>
        <h1 class = "discount1">₱800</h1>
        <div class = discountline11></div>  <!--this is for the design(the discount line)  -->
        </div>

        <div class="order9" onmouseenter="popUp1(this)" onmouseleave="popDown1(this)">
        <img src="{% static 'products/mobile3.webp' %}" alt="Product Image" class="productimage1">
        <button class="orderadd1" onclick="addToCart(this)" data-item-id="mobile3"  onmouseenter="addpopup(this)" onmouseleave="addpodown(this)">Add</button>
        <h1 class = "order1title">Metal Mobile Phone Stand</h1>
        <div class = "containmentprder">  <!--this is for the design(the line)  -->
        </div>
        <h1 class = "orderprice1">₱180</h1>
        <h1 class = "discount1">₱320</h1>
        <div class = discountline11></div>  <!--this is for the design(the discount line)  -->
        </div>

        <div class="order10" onmouseenter="popUp1(this)" onmouseleave="popDown1(this)">
        <img src="{% static 'products/mobile4.webp' %}" alt="Product Image" class="productimage1">
        <button class="orderadd1" onclick="addToCart(this)" data-item-id="mobile4" onmouseenter="addpopup(this)" onmouseleave="addpodown(this)">Add</button>
        <h1 class = "order1title">Orashare Slim Powerbank 20000mAh</h1>
        <div class = "containmentprder">  <!--this is for the design(the line)  -->
        </div>
        <h1 class = "orderprice1">₱329</h1>
        <h1 class = "discount1">₱610</h1>
        <div class = discountline11></div>  <!--this is for the design(the discount line)  -->
        </div>

          <div class="order11" onmouseenter="popUp1(this)" onmouseleave="popDown1(this)">
        <img src="{% static 'products/console3.webp' %}" alt="Product Image" class="productimage1">
        <button class="orderadd1" onclick="addToCart(this)" data-item-id="console3" 
          onmouseenter="addpopup(this)" onmouseleave="addpodown(this)">Add</button>
        <h1 class="order1title">Transnovo VR Controller Grips</h1>
        <div class="containmentprder"></div>
        <h1 class="orderprice1">₱249</h1>
        <h1 class="discount1">₱520</h1>
        <div class="discountline11"></div>
      </div>

        <div class="order12" onmouseenter="popUp1(this)" onmouseleave="popDown1(this)">
        <img src="{% static 'products/console4.webp' %}" alt="Product Image" class="productimage1">
        <button class="orderadd1" onclick="addToCart(this)" data-item-id="console4" onmouseenter="addpopup(this)" onmouseleave="addpodown(this)">Add</button>
        <h1 class = "order1title">Dual Controller Fast Charger for PS5 </h1>
        <div class = "containmentprder">  <!--this is for the design(the line)  -->
        </div>
        <h1 class = "orderprice1">₱599</h1>
        <h1 class = "discount1">₱780</h1>
        <div class = discountline11></div>  <!--this is for the design(the discount line)  -->
        </div>
        

        <div class = "add_cart">
          <div class ="cart_items">

          </div>
        </div>



    </div>      
             

            <!--panel content here-->
        


        

        <!--for javascript-->
        <script>
            
    

let isToggling = false;

function toggleFrame() {

  if (isToggling) return;

  const frame = document.getElementById("cartFrame");
  const order = document.querySelector(".order6");
  const order2 = document.querySelector(".order7");
  const order3 = document.querySelector(".order12");
  const notice = document.querySelector(".notice");
  const panel = document.querySelector(".panel")
  const logofilter = document.querySelector(".filterlogo")
  const filtertext = document.querySelector(".filter")
  const dropdown = document.querySelector(".custom-dropdown")
 


  const isVisible = frame.classList.contains("visible");

  isToggling = true;

  // Toggle cart frame visibility
  frame.classList.toggle("visible");


    // Resize the upper frame 
  notice.classList.toggle("resized");
  panel.classList.toggle("resized");

   // reposition's the pos of the panel's content
  logofilter.classList.toggle("newpos");
  filtertext.classList.toggle("newpos");
  dropdown.classList.toggle("newpos");
  dropdown.classList.add("no-hover");  //so that there is no interferance for the animation when being hovered on



  // This changes the position for when clicking the 
    if (!isVisible) {
    // Set transform and store base transform
    order.dataset.baseTransform = "translate(-1575px, 443px)";
    order.style.transform = `${order.dataset.baseTransform} scaleY(1)`;

    order2.dataset.baseTransform = "translate(0px, 443px)";
    order2.style.transform = `${order2.dataset.baseTransform} scaleY(1)`;

    order3.dataset.baseTransform = "translate(-1260px, 443px)";
    order3.style.transform = `${order3.dataset.baseTransform} scaleY(1)`;
  } else {
    // Reset's the poisiot of the orders 
    order.dataset.baseTransform = "translate(0px, 0px)";
    order.style.transform = `${order.dataset.baseTransform} scaleY(1)`;

    order2.dataset.baseTransform = "translate(0px, 0px)";
    order2.style.transform = `${order2.dataset.baseTransform} scaleY(1)`;

    order3.dataset.baseTransform = "translate(0px,0px)";
    order3.style.transform = `${order3.dataset.baseTransform} scaleY(1)`;
  }


  setTimeout(() => {
    isToggling = false;
    dropdown.classList.remove("no-hover"); 
  }, 880); // match transition duration
}



function activateStoreButton() {
  const buttons = document.querySelectorAll(".categories button");

  // Remove active class from all buttons
  buttons.forEach(b => b.classList.remove("active"));

  // Add active class to store button
  const storeBtn = document.querySelector(".categories .store");
  if (storeBtn) {
    storeBtn.classList.add("active");
  }
}

// Setup click events
document.addEventListener("DOMContentLoaded", function () {
  const buttons = document.querySelectorAll(".categories button");

  buttons.forEach(button => {
    button.addEventListener("click", function () {
      buttons.forEach(b => b.classList.remove("active")); // this removes all the active button ensuring that there is no active button
      this.classList.add("active"); //sets active for the button that you click
    });
  });

  activateStoreButton(); // Set default active on first load
}); 

// Handle back/forward navigation
window.addEventListener("pageshow", function () {
  activateStoreButton(); // Set store as active again if your trying to back page
});;





             document.addEventListener("DOMContentLoaded", function () {
    const buttons = document.querySelectorAll(".buttonlay button"); // this gets all the buttons from the buttonlay class

    buttons.forEach(button => {
      button.addEventListener("click", function () {
        // Remove active class from all
        buttons.forEach(b => b.classList.remove("active"));
        // Add active to clicked one
        this.classList.add("active");
      });
    });

    // Set "All" as active by default
    document.querySelector(".buttonlay .all").classList.add("active");
  });


          

        //this for the effect when hovering an order
        function popUp1(element) {
  const base = element.dataset.baseTransform || "translate(0, 0)";
  element.style.transform = `${base} scaleY(1.01)`;
  element.style.transform = `${base} scaleX(1.01)`;
  element.style.transition = "transform 0.2s ease";
}

function popDown1(element) {
  const base = element.dataset.baseTransform || "translate(0, 0)";
  element.style.transform = `${base} scale(1)`;

}
      
function addpopup(element) {
  const base = element.dataset.baseTransform || "translate(0, 0)";
  element.style.transform = `${base} scaleY(1.04)`;
  element.style.transform = `${base} scaleX(1.04)`;
  element.style.transition = "transform 0.2s ease";
}

function addpodown(element) {
  const base = element.dataset.baseTransform || "translate(0, 0)";
  element.style.transform = `${base} scale(1)`;

}


function toggleDropdown(dropdown) {
  const options = dropdown.querySelector(".dropdown-options");
  options.style.display = options.style.display === "block" ? "none" : "block";
}

document.querySelectorAll(".dropdown-options div").forEach(option => { //this loops through all the option items 
  option.addEventListener("click", function () {                        //so this lines here adds a click event listener
    const dropdown = this.closest(".custom-dropdown");                  // finds parent 
    dropdown.querySelector(".selected").textContent = this.textContent; //finds the selected box and sets the upper box
    console.log("Selected value:", this.dataset.value); // this just outputs to the console
    dropdown.querySelector(".dropdown-options").style.display = "none";// hides the dropdown list after an option is clicked
  });
});
//this for closing whenever you click outside of the dropbox
document.addEventListener("click",function(event){
    document.querySelectorAll(".custom-dropdown").forEach(dropdown=>{
        if(!dropdown.contains(event.target)){
            dropdown.querySelector(".dropdown-options").style.display = "none";
        }
    });
});


function addToCart(button) {
    // Get item ID from the button's data attribute
    const itemId = button.getAttribute('data-item-id');

    // Send it to your Django backend via POST
    fetch('/shop/', {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCookie('csrftoken'),
            'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: `item_id=${encodeURIComponent(itemId)}`
    })
    .then(response => response.json())
    .then(data => {
        console.log(data.message || "Item added");
    })
    .catch(error => {
        console.error("Error adding item:", error);
    });
}

// Automatically run on page load (or trigger by button)


// CSRF token helper
function getCookie(name) {
    // Extracts CSRF token from browser cookies
     let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';'); 
        for (let cookie of cookies) {
            cookie = cookie.trim();
            if (cookie.startsWith(name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}




const cartItemsContainer = document.querySelector(".cart-items");
let cart = [];

// Function to add an item to cart
function addToCart(button) {
  const productElement = button.closest(".order11"); // Get the product card

  const item = {
    id: button.getAttribute("data-item-id"),
    name: productElement.querySelector(".order1title").textContent,
    price: productElement.querySelector(".orderprice1").textContent,
    img: productElement.querySelector("img").src
  };

  cart.push(item);
  renderCart();
}

// Function to display cart items
function renderCart() {
  cartItemsContainer.innerHTML = "";
  cart.forEach(item => {
    const div = document.createElement("div");
    div.classList.add("cart-item");
    div.innerHTML = `
  <img src="${item.img}" alt="${item.name}" class="cart-image">
  <div class="cart-item-details">
    <div class="cart-item-name">${item.name}</div>
    <div class="cart-item-price">${item.price}</div>
  </div>
`;
    cartItemsContainer.appendChild(div);
  });
}
</script>

    </body>

</html>